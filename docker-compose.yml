version: "3.9"

volumes:
  firebase_emulator_data:

services:
  firebase_auth_emulator:
    build:
      context: .
      dockerfile: Dockerfile.firebase-emulator
    volumes:
      - ./firebase.json:/src/firebase.json
      - firebase_emulator_data:/src/.firebase-emulator
    ports:
      - "9099:9099"
      - "4000:4000"
    command: firebase emulators:start --project ethernal-95a14 --import=/src/.firebase-emulator/data --export-on-exit
  high_priority_worker:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    depends_on:
      - firebase_auth_emulator
    env_file: run/.env
    command: node workers/highPriority.js
  medium_priority_worker:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    depends_on:
      - firebase_auth_emulator
    env_file: run/.env
    command: node workers/mediumPriority.js
  low_priority_worker:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    depends_on:
      - firebase_auth_emulator
    env_file: run/.env
    command: node workers/lowPriority.js
  web:
    volumes:
      - ./run/:/app
    depends_on:
      - firebase_auth_emulator
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    ports:
      - "8888:8888"
    env_file: run/.env
    command: node index.js
  front:
    extra_hosts:
      - "app.ethernal.local:0.0.0.0"
      - "*.ethernal.explorer:0.0.0.0"
    depends_on:
      - web
      - firebase_auth_emulator
    ports:
      - "8080:8080"
    build:
      context: .
      dockerfile: Dockerfile.front
      target: dev
    env_file: .env.development
